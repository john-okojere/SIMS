{% extends 'base.html' %}
{% load static %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<style>
    .d-flex{
        gap: 1rem;
        flex-wrap: wrap;

    }
</style>
<img class="img-fluid" src="{% static 'img/hq.jpg' %}" alt="">
<div class="my-3">
    <hr>
<h1>Welcome to the Student Information Management System (SIMS) Dashboard</h1>
    <p class="text-muted">This is your dashboard where you can navigate to various sections of the system.</p>
</div>
</div>
<!-- User-Specific Dashboard Buttons -->
 
<div class="dashboard-container container" style="display: flex; flex-wrap: wrap; gap: 20px;">
    {% if is_admin %}
        <!-- Admin Section -->
        <div class="dashboard-box">
            <h3 class="card-title"> Welcome, {{ request.user.username }} to Admin Dashboard</h3><hr>
            <div class = "d-flex">
            <div  class="card" style="width: 18rem; padding: 20px;">
                <p>View the complete list of students and their details.</p>
                <a href="{% url 'student_list' %}" class="btn btn-primary">View All Students</a>
            </div>
            
            <div  class="card" style="width: 18rem; padding: 20px;">
                <p>Manage courses, update details, and add new ones.</p>
                <a href="{% url 'course_list' %}" class="btn btn-info">Manage Courses</a>
            </div>
            
            <div  class="card" style="width: 18rem; padding: 20px;">
                <p>Access and review student medical records.</p>
                <a href="#" class="btn btn-warning">View Medical Records</a>
            </div>
            
            <div  class="card" style="width: 18rem; padding: 20px;">
                <p>View all student results and academic performance.</p>
                <a href="{% url 'result_list' %}" class="btn btn-success">View All Results</a>
            </div>
            </div>

        </div>

    {% elif user.role == "LECTURER" %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Include Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Lecturer Section -->
        <div class="dashboard-box">
            <h3 class="card-title"> Welcome, {{ request.user.username }} to Lecturer Dashboard</h3><hr>
            <div class = "d-flex">
            <div  class="card" style="width: 18rem; padding: 20px;">
                <p>View all the courses your ar to teach.</p>
                <a href="{% url 'lecturer_courses' %}" class="btn btn-primary">View Courses</a>
            </div>
            <div  class="card" style="width: 18rem; padding: 20px;">
                <p>View all students who have registered for your courses.</p>
                <a href="{% url 'lecturer_view_students' %}" class="btn btn-primary">View Registered Students</a>
            </div>
            <div  class="card" style="width: 18rem; padding: 20px;">
                <p>Input and manage grades for students in your courses.</p>
                <a href="{% url 'lecturer_input_grades' %}" class="btn btn-secondary">Input Grades</a>
            </div>
            
            <div  class="card" style="width: 18rem; padding: 20px;">
                <p>View timetable for your courses.</p>
                <a href="{% url 'lecturer_view_timetable' %}" class="btn btn-info">View Timetable</a>
            </div>
            <div  class="card" style="width: 18rem; padding: 20px;">
                <p>View and update your personal profile details.</p>
            {% if user.lecturer %}
            <a href="{% url 'lecturer_profile' %}" class="btn btn-warning">View Profile</a>
                </div>
            {% else %}
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#updateDepartmentModal">
                    Update Department
                </button>
            {% endif %}

        </div>
        </div>

        </div>
 <!-- Modal for updating Year of Study -->
 <div class="modal fade" id="updateDepartmentModal" tabindex="-1" aria-labelledby="updateDepartmentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="updateDepartmentModalLabel">Update Department</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="DepartmentForm">
                    <div class="mb-3">
                        <label for="DepartmentInput" class="form-label">Department</label>
                        <input type="text" class="form-control" id="DepartmentInput" name="department" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    // Submit the form via AJAX
    document.getElementById('DepartmentForm').addEventListener('submit', function(event) {
        event.preventDefault();
        
        const update_department_val = document.getElementById('DepartmentInput').value;
        
        fetch("{% url 'update_department' %}", {
            method: "POST",
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                'department': update_department_val
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
                location.reload();  // Refresh the page to update year of study
            } else {
                alert(data.message);
            }
        })
        .catch(error => console.error('Error:', error));
    });
</script>
    {% elif user.role == "STUDENT" %}
    <!-- Include Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Include Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

        <!-- Student Section -->
        <div class="dashboard-box">
            <h3 class="card-title"> Welcome, {{ request.user.username }} to Student Dashboard</h3><hr>
            <div class = "d-flex">
            <div  class="card" style="width: 18rem; padding: 20px;">
                <p>View your exam results and academic performance.</p>
                <a href="{% url 'result_list' %}" class="btn btn-primary">View Results</a>
            </div>
            
            <div  class="card" style="width: 18rem; padding: 20px;">
                <p>View your personal timetable based on registered courses.</p>
                <a href="{% url 'student_view_timetable' %}" class="btn btn-info">View Timetable</a>
            </div>
                <div  class="card" style="width: 18rem; padding: 20px;">
                    <p>View and update your personal profile details.</p>
            {% if user.student %}
            <a href="{% url 'student_profile' %}" class="btn btn-warning">View Profile</a>
                </div>
            {% else %}
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#updateYearModal">
                    Update Year of Study
                </button>
            {% endif %}

            </div>

        </div>
 <!-- Modal for updating Year of Study -->
 <div class="modal fade" id="updateYearModal" tabindex="-1" aria-labelledby="updateYearModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="updateYearModalLabel">Update Year of Study</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="yearOfStudyForm">
                    <div class="mb-3">
                        <label for="yearOfStudyInput" class="form-label">Year of Study</label>
                        <input type="number" class="form-control" id="yearOfStudyInput" name="year_of_study" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    // Submit the form via AJAX
    document.getElementById('yearOfStudyForm').addEventListener('submit', function(event) {
        event.preventDefault();
        
        const yearOfStudy = document.getElementById('yearOfStudyInput').value;
        
        fetch("{% url 'update_year_of_study' %}", {
            method: "POST",
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                'year_of_study': yearOfStudy
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
                location.reload();  // Refresh the page to update year of study
            } else {
                alert(data.message);
            }
        })
        .catch(error => console.error('Error:', error));
    });
</script>
    {% elif is_clinic_staff %}
        <!-- Clinic Staff Section -->
        <div class="dashboard-box">
            <h3 class="card-title"> Welcome, {{ request.user.username }} to Clinic Staff Dashboard</h3><hr>
            <div class = "d-flex">
            <div  class="card" style="width: 18rem; padding: 20px;">
                <p>View student medical records to assist in treatment.</p>
                <a href="{% url 'view_student_medical_records' %}" class="btn btn-primary">View Student Medical Records</a>
            </div>
            
            <div  class="card" style="width: 18rem; padding: 20px;">
                <p>Update student medical records with new information.</p>
                <a href="{% url 'update_medical_records' %}" class="btn btn-secondary">Update Medical Records</a>
            </div>
        </div>
    {% endif %}
</div>
 
{% endblock %}
